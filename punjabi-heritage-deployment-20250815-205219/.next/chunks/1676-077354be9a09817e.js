"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1676],{98:(e,t,r)=>{r.d(t,{_:()=>p,e:()=>s});var o=r(5155),a=r(2115),n=r(9475),c=r(3285),i=r(6671);let l={items:[],total:0,itemCount:0,loading:!1};function d(e,t){switch(t.type){case"ADD_ITEM":{let r;let o=e.items.findIndex(e=>e.productId===t.payload.productId&&e.size===t.payload.size&&e.color===t.payload.color),a=(r=o>-1?e.items.map((e,r)=>r===o?{...e,quantity:Math.min(e.quantity+t.payload.quantity,e.stock)}:e):[...e.items,t.payload]).reduce((e,t)=>e+t.price*t.quantity,0),n=r.reduce((e,t)=>e+t.quantity,0);return{...e,items:r,total:a,itemCount:n}}case"REMOVE_ITEM":{let r=e.items.filter(e=>e.productId!==t.payload.split("-")[0]||e.size!==t.payload.split("-")[1]||e.color!==t.payload.split("-")[2]),o=r.reduce((e,t)=>e+t.price*t.quantity,0),a=r.reduce((e,t)=>e+t.quantity,0);return{...e,items:r,total:o,itemCount:a}}case"UPDATE_QUANTITY":{let r=e.items.map(e=>"".concat(e.productId,"-").concat(e.size,"-").concat(e.color)===t.payload.id?{...e,quantity:Math.max(0,Math.min(t.payload.quantity,e.stock))}:e).filter(e=>e.quantity>0),o=r.reduce((e,t)=>e+t.price*t.quantity,0),a=r.reduce((e,t)=>e+t.quantity,0);return{...e,items:r,total:o,itemCount:a}}case"CLEAR_CART":return{...l,loading:e.loading};case"LOAD_CART":{let r=t.payload.reduce((e,t)=>e+t.price*t.quantity,0),o=t.payload.reduce((e,t)=>e+t.quantity,0);return{...e,items:t.payload,total:r,itemCount:o,loading:!1}}case"SET_LOADING":return{...e,loading:t.payload};case"CART_ERROR":return i.oR.error(t.payload),{...e,loading:!1};default:return e}}let u=(0,a.createContext)(void 0);function s(e){let{children:t}=e,[r,s]=(0,a.useReducer)(d,l),{isAuthenticated:p,user:m}=(0,n.t)(),y=(0,c.F)({onCartUpdate:e=>{(null==e?void 0:e.items)&&s({type:"LOAD_CART",payload:e.items.map(e=>({id:"".concat(e.productId,"-").concat(e.size,"-").concat(e.color),productId:e.productId,name:e.name,punjabiName:e.punjabiName,price:e.price,image:e.image,size:e.size,color:e.color,quantity:e.quantity,stock:e.stock}))})},onConnect:()=>{var e;p&&(null==y?void 0:null===(e=y.socket)||void 0===e?void 0:e.connected)&&(null==y||y.socket.emit("get-cart"))},onError:e=>{}}),[f,v]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{var e;try{let e=localStorage.getItem("punjabi-heritage-cart");if(e){let t=JSON.parse(e);Array.isArray(t)&&t.length>0&&s({type:"LOAD_CART",payload:t})}}catch(e){console.error("Error loading cart from localStorage:",e);try{localStorage.removeItem("punjabi-heritage-cart")}catch(e){console.error("Error clearing corrupted cart data:",e)}}if(v(!0),p&&(null==y?void 0:null===(e=y.socket)||void 0===e?void 0:e.connected))try{y.socket.emit("get-cart")}catch(e){console.error("Error requesting cart from server:",e)}},[]),(0,a.useEffect)(()=>{if(f)try{localStorage.setItem("punjabi-heritage-cart",JSON.stringify(r.items))}catch(e){console.error("Error saving cart to localStorage:",e)}},[r.items,f]),(0,a.useEffect)(()=>{var e;if((null==y?void 0:null===(e=y.socket)||void 0===e?void 0:e.connected)&&p)return y.socket.on("cart-loaded",e=>{s({type:"LOAD_CART",payload:e.items.map(e=>({id:"".concat(e.productId,"-").concat(e.size,"-").concat(e.color),productId:e.productId,name:e.name,punjabiName:e.punjabiName,price:e.price,image:e.image,size:e.size,color:e.color,quantity:e.quantity,stock:e.stock}))})}),y.socket.on("cart-updated",e=>{s({type:"LOAD_CART",payload:e.items.map(e=>({id:"".concat(e.productId,"-").concat(e.size,"-").concat(e.color),productId:e.productId,name:e.name,punjabiName:e.punjabiName,price:e.price,image:e.image,size:e.size,color:e.color,quantity:e.quantity,stock:e.stock}))})}),y.socket.on("cart-cleared",()=>{s({type:"CLEAR_CART"}),i.oR.success("Cart cleared")}),y.socket.on("cart-error",e=>{s({type:"CART_ERROR",payload:e.message})}),y.socket.on("auth-required",e=>{i.oR.error(e.message)}),()=>{var e,t,r,o,a;null===(e=y.socket)||void 0===e||e.off("cart-loaded"),null===(t=y.socket)||void 0===t||t.off("cart-updated"),null===(r=y.socket)||void 0===r||r.off("cart-cleared"),null===(o=y.socket)||void 0===o||o.off("cart-error"),null===(a=y.socket)||void 0===a||a.off("auth-required")}},[y,p]),(0,o.jsx)(u.Provider,{value:{state:r,addItem:e=>{var t;let r={...e,quantity:e.quantity||1};p&&(null==y?void 0:null===(t=y.socket)||void 0===t?void 0:t.connected)?(y.socket.emit("add-to-cart",{productId:e.productId,name:e.name,punjabiName:e.punjabiName,price:e.price,image:e.image,size:e.size,color:e.color,quantity:e.quantity||1,stock:e.stock}),s({type:"SET_LOADING",payload:!0})):(s({type:"ADD_ITEM",payload:r}),i.oR.success("Item added to cart"))},removeItem:(e,t,r)=>{var o;if(p&&(null==y?void 0:null===(o=y.socket)||void 0===o?void 0:o.connected)){let[o]=e.split("-");y.socket.emit("remove-from-cart",{productId:o,size:t,color:r}),s({type:"SET_LOADING",payload:!0})}else s({type:"REMOVE_ITEM",payload:"".concat(e,"-").concat(t,"-").concat(r)}),i.oR.success("Item removed from cart")},updateQuantity:(e,t,r,o)=>{var a;if(p&&(null==y?void 0:null===(a=y.socket)||void 0===a?void 0:a.connected)){let[a]=e.split("-");y.socket.emit("update-cart-item",{productId:a,size:t,color:r,quantity:o}),s({type:"SET_LOADING",payload:!0})}else s({type:"UPDATE_QUANTITY",payload:{id:"".concat(e,"-").concat(t,"-").concat(r),quantity:o}})},clearCart:()=>{var e;p&&(null==y?void 0:null===(e=y.socket)||void 0===e?void 0:e.connected)?(y.socket.emit("clear-cart"),s({type:"SET_LOADING",payload:!0})):(s({type:"CLEAR_CART"}),i.oR.success("Cart cleared"))}},children:t})}function p(){let e=(0,a.useContext)(u);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},3285:(e,t,r)=>{r.d(t,{F:()=>i});var o=r(2115),a=r(4298),n=r(9509);let c={url:null,options:{transports:["websocket","polling"],autoConnect:!1,reconnection:!1,reconnectionAttempts:0,reconnectionDelay:1e3,timeout:2e4,forceNew:!0}};function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,o.useState)(!1),[n,i]=(0,o.useState)(!1),l=(0,o.useRef)(null);(0,o.useEffect)(()=>((()=>{var t;if(!c.url||(null===(t=l.current)||void 0===t?void 0:t.connected)){i(!1),r(!1);return}i(!0);try{l.current=(0,a.io)(c.url,{...c.options,auth:{token:localStorage.getItem("auth-token")}});let t=l.current;t.on("connect",()=>{var t;r(!0),i(!1),null===(t=e.onConnect)||void 0===t||t.call(e)}),t.on("disconnect",t=>{var o;r(!1),i(!1),null===(o=e.onDisconnect)||void 0===o||o.call(e)}),t.on("connect_error",e=>{r(!1),i(!1)}),t.on("order-notification",t=>{try{var r;null===(r=e.onOrderNotification)||void 0===r||r.call(e,t)}catch(e){console.error("Error handling order notification:",e)}}),t.on("product-update",t=>{try{var r;null===(r=e.onProductUpdate)||void 0===r||r.call(e,t)}catch(e){console.error("Error handling product update:",e)}}),t.on("cart-updated",t=>{try{var r;null===(r=e.onCartUpdate)||void 0===r||r.call(e,t)}catch(e){console.error("Error handling cart update:",e)}}),t.on("auth-required",t=>{try{var r;null===(r=e.onAuthRequired)||void 0===r||r.call(e,t)}catch(e){console.error("Error handling auth required:",e)}}),t.on("join-admin",()=>{})}catch(e){i(!1),r(!1)}})(),()=>{if(l.current)try{l.current.disconnect(),l.current=null}catch(e){console.error("Error cleaning up socket:",e)}}),[e]),(0,o.useEffect)(()=>{let e=localStorage.getItem("auth-token");l.current&&e&&l.current.emit("authenticate",{token:e})},[]);let d=(e,t)=>{var r;(null===(r=l.current)||void 0===r?void 0:r.connected)?l.current.emit(e,t):console.warn("Socket not connected, cannot emit:",e)};return{socket:l.current,isConnected:t,isConnecting:n,emit:d,joinAdminRoom:()=>{d("join-admin")},emitNewOrder:e=>{d("new-order",e)},emitOrderStatusUpdate:e=>{d("order-status-update",e)},emitInventoryUpdate:e=>{d("inventory-update",e)},emitAddToCart:e=>{d("add-to-cart",e)},emitUpdateCartItem:e=>{d("update-cart-item",e)},emitRemoveFromCart:e=>{d("remove-from-cart",e)},emitClearCart:()=>{d("clear-cart")},emitProfileUpdate:e=>{d("profile-updated",e)}}}"http://".concat("3.111.208.77",":").concat("3003"),n.env.MONGODB_URI,n.env.RAZORPAY_KEY_SECRET},3999:(e,t,r)=>{r.d(t,{cn:()=>n});var o=r(2596),a=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,o.$)(t))}},7168:(e,t,r)=>{r.d(t,{$:()=>d});var o=r(5155),a=r(2115),n=r(9708),c=r(2085),i=r(3999);let l=(0,c.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:r,variant:a,size:c,asChild:d=!1,...u}=e,s=d?n.DX:"button";return(0,o.jsx)(s,{className:(0,i.cn)(l({variant:a,size:c,className:r})),ref:t,...u})});d.displayName="Button"},8482:(e,t,r)=>{r.d(t,{BT:()=>d,Wu:()=>u,ZB:()=>l,Zp:()=>c,aR:()=>i});var o=r(5155),a=r(2115),n=r(3999);let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});c.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})});i.displayName="CardHeader";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});l.displayName="CardTitle";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...a})});d.displayName="CardDescription";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...a})});u.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,o.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},8915:(e,t,r)=>{r.d(t,{hJ:()=>i,j2:()=>c});var o=r(3915),a=r(6203);let n=(0,o.Wp)({apiKey:"AIzaSyA96W2Y6321lit2B2HuPOPIdY-MS9dytl4",authDomain:"punjabiecom-dc8ea.firebaseapp.com",projectId:"punjabiecom-dc8ea",storageBucket:"punjabiecom-dc8ea.firebasestorage.app",messagingSenderId:"248407809084",appId:"1:248407809084:web:769700a9c267ac2a5e3739",measurementId:"G-VNY53M2Q6L"}),c=(0,a.xI)(n),i=new a.HF;i.setCustomParameters({prompt:"select_account"})},9475:(e,t,r)=>{r.d(t,{$:()=>l,t:()=>d});var o=r(5155),a=r(2115),n=r(6203),c=r(8915);let i=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[d,u]=(0,a.useState)(!0),[s,p]=(0,a.useState)(null),m=e=>({uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,phoneNumber:e.phoneNumber});(0,a.useEffect)(()=>{let e=null;try{e=(0,n.hg)(c.j2,e=>{try{e?l(m(e)):l(null),u(!1)}catch(e){console.error("Error processing auth state change:",e),p("Authentication error occurred"),u(!1)}},e=>{console.error("Firebase auth state change error:",e),p("Authentication service error"),u(!1)})}catch(e){console.error("Error setting up auth listener:",e),p("Failed to initialize authentication"),u(!1)}return()=>{if(e)try{e()}catch(e){console.error("Error cleaning up auth listener:",e)}}},[]);let y=async(e,t)=>{try{u(!0),p(null);let r=await (0,n.x9)(c.j2,e,t);l(m(r.user))}catch(e){throw p(e.message||"Failed to log in"),e}finally{u(!1)}},f=async(e,t,r)=>{try{u(!0),p(null);let o=await (0,n.eJ)(c.j2,e,t);await (0,n.r7)(o.user,{displayName:r}),l(m(o.user))}catch(e){throw p(e.message||"Failed to create account"),e}finally{u(!1)}},v=async()=>{console.log("Google login clicked");try{u(!0),p(null),console.log("About to call signInWithPopup");let e=await (0,n.df)(c.j2,c.hJ);console.log("Google login successful:",e.user.email),l(m(e.user))}catch(e){throw console.error("Google login error:",e),p(e.message||"Failed to sign in with Google"),e}finally{u(!1)}},g=async()=>{try{u(!0),p(null),await (0,n.CI)(c.j2),l(null)}catch(e){throw p(e.message||"Failed to log out"),e}finally{u(!1)}},h=async e=>{if(!c.j2.currentUser)throw Error("No authenticated user");try{u(!0),p(null),await (0,n.r7)(c.j2.currentUser,e),r&&l({...r,displayName:e.displayName||r.displayName,photoURL:e.photoURL||r.photoURL})}catch(e){throw p(e.message||"Failed to update profile"),e}finally{u(!1)}};return(0,o.jsx)(i.Provider,{value:{user:r,loading:d,error:s,login:y,signup:f,loginWithGoogle:v,logout:g,updateUserProfile:h,isAuthenticated:!!r,clearError:()=>p(null)},children:t})}function d(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useFirebaseAuth must be used within a FirebaseAuthProvider");return e}}}]);