(()=>{var e={};e.id=5044,e.ids=[5044],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10713:(e,r,t)=>{"use strict";t.d(r,{Ww:()=>l});var a=t(29021),n=t.n(a),s=t(33873),o=t.n(s);let i=o().resolve(process.cwd(),"data"),u=o().join(i,"orders.json");n().existsSync(i)||n().mkdirSync(i,{recursive:!0});let d=null;function c(e){try{let r=Array.from(e.values());n().writeFileSync(u,JSON.stringify(r,null,2),"utf8")}catch(e){console.error("Error saving orders to file:",e)}}function p(){return d||(d=function(){if(!n().existsSync(u))return n().writeFileSync(u,JSON.stringify([]),"utf8"),new Map;try{let e=n().readFileSync(u,"utf8"),r=JSON.parse(e),t=new Map;return r.forEach(e=>{t.set(e.id,e)}),t}catch(e){return console.error("Error loading orders from file:",e),new Map}}()),d}let l={get:e=>p().get(e),set(e,r){p().set(e,r),c(p())},has:e=>p().has(e),delete(e){let r=p().delete(e);return r&&c(p()),r},values:()=>p().values(),clear(){p().clear(),c(p())}}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23848:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>f,serverHooks:()=>I,workAsyncStorage:()=>E,workUnitAsyncStorage:()=>S});var a={};t.r(a),t.d(a,{GET:()=>m,POST:()=>l});var n=t(96559),s=t(48088),o=t(37719),i=t(32190),u=t(55511),d=t.n(u),c=t(70239),p=t(10713);async function l(e){try{let{orderId:r,paymentId:t,signature:a,paymentMethod:n,bankTransferDetails:s,upiDetails:o}=await e.json();if(!r)return i.NextResponse.json({error:"Order ID is required"},{status:400});let u=p.Ww.get(r);if(!u)return i.NextResponse.json({error:"Order not found"},{status:404});let d=!1,l=c.QZ.FAILED,m=u.orderStatus;switch(n||u.paymentMethod){case"razorpay":(d=await y(u.razorpayOrderId||"",t,a))&&(l=c.QZ.COMPLETED,m=c.w8.CONFIRMED,u.razorpayPaymentId=t,u.razorpaySignature=a);break;case"cod":l=c.QZ.PENDING,m=c.w8.CONFIRMED,d=!0;break;case"upi":(o?.transactionId||t)&&(t&&a?d=await y(u.razorpayOrderId||"",t,a):o?.transactionId&&(d=!0),d&&(l=c.QZ.COMPLETED,m=c.w8.CONFIRMED,u.paymentId=t||o?.transactionId,u.upiTransactionId=o?.transactionId,u.notes=`UPI Payment: ${o?.transactionId||t}`));break;case"bank_transfer":s?.transactionId&&(l=c.QZ.PROCESSING,m=c.w8.CREATED,u.paymentId=s.transactionId,u.notes=`Bank transfer: ${s.transactionId}`,d=!0);break;default:return i.NextResponse.json({error:"Unsupported payment method"},{status:400})}if(u.paymentStatus=l,u.orderStatus=m,u.updatedAt=new Date().toISOString(),t&&(u.paymentId=t),p.Ww.set(r,u),d)return i.NextResponse.json({success:!0,message:"Payment verified successfully",order:{id:u.id,orderNumber:u.orderNumber,paymentStatus:u.paymentStatus,orderStatus:u.orderStatus,total:u.total,paymentMethod:u.paymentMethod}});return i.NextResponse.json({error:"Payment verification failed"},{status:400})}catch(e){return console.error("Payment verification error:",e),i.NextResponse.json({error:"Payment verification failed",details:e.message},{status:500})}}async function y(e,r,t){try{let a=process.env.RAZORPAY_KEY_SECRET;if(!a)return console.error("Razorpay key secret not configured"),!1;let n=d().createHmac("sha256",a).update((e+"|"+r).toString()).digest("hex"),s=n===t;return console.log("Payment verification:",{orderId:e,paymentId:r,providedSignature:t,expectedSignature:n,isValid:s}),s}catch(e){return console.error("Razorpay verification error:",e),!1}}async function m(e){let{searchParams:r}=new URL(e.url),t=r.get("orderId");if(!t)return i.NextResponse.json({error:"Order ID is required"},{status:400});let a=p.Ww.get(t);return a?i.NextResponse.json({success:!0,paymentStatus:a.paymentStatus,orderStatus:a.orderStatus,order:{id:a.id,orderNumber:a.orderNumber,paymentStatus:a.paymentStatus,orderStatus:a.orderStatus,total:a.total,paymentMethod:a.paymentMethod}}):i.NextResponse.json({error:"Order not found"},{status:404})}let f=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/payment/verify/route",pathname:"/api/payment/verify",filename:"route",bundlePath:"app/api/payment/verify/route"},resolvedPagePath:"/Users/harsh/Downloads/punjabi-ecom-storeV4/app/api/payment/verify/route.ts",nextConfigOutput:"standalone",userland:a}),{workAsyncStorage:E,workUnitAsyncStorage:S,serverHooks:I}=f;function g(){return(0,o.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:S})}},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70239:(e,r,t)=>{"use strict";t.d(r,{QZ:()=>n,sF:()=>a,w8:()=>s});let a={razorpay:{keyId:"rzp_live_your_actual_key_id",keySecret:process.env.RAZORPAY_KEY_SECRET||"your_secret_key",currency:"INR",companyName:"Punjab Heritage Store",description:"Traditional Punjabi Products",webhookSecret:process.env.RAZORPAY_WEBHOOK_SECRET||"webhook_secret"},upi:{enabled:!0,upiId:"punjabheritageg@paytm",merchantVpa:"punjabheritage@okaxis",qrCodeEnabled:!0,description:"Pay instantly using any UPI app"},bankTransfer:{accountName:"Punjab Heritage Store",accountNumber:"1234567890",ifscCode:"HDFC0000123",bankName:"HDFC Bank",branch:"Main Branch",upiId:"punjabheritageg@paytm"},cod:{enabled:!0,minAmount:0,maxAmount:5e4,serviceFee:0,description:"Pay when your order is delivered to your doorstep"},general:{currency:"INR",currencySymbol:"â‚¹",taxRate:0,shippingFee:0,minOrderAmount:1}},n={PENDING:"pending",PROCESSING:"processing",COMPLETED:"completed",FAILED:"failed",CANCELLED:"cancelled",REFUNDED:"refunded"},s={CREATED:"created",CONFIRMED:"confirmed",PROCESSING:"processing",SHIPPED:"shipped",DELIVERED:"delivered",CANCELLED:"cancelled",REFUNDED:"refunded"}},78335:()=>{},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[4447,580],()=>t(23848));module.exports=a})();