(()=>{var e={};e.id=3146,e.ids=[3146],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},58432:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>l,serverHooks:()=>g,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{GET:()=>p});var a=r(96559),o=r(48088),i=r(37719),n=r(32190),c=r(83243);async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("category"),s=t.get("subcategory"),a=t.get("search"),o=parseInt(t.get("page")||"1"),i=parseInt(t.get("limit")||"12"),p=t.get("sortBy")||t.get("sort")||"createdAt",l=t.get("sortOrder")||"desc",u=t.get("priceRange"),d=(await (0,c.d$)()).filter(e=>{if(!0!==e.isActive&&void 0!==e.isActive||r&&"all"!==r&&e.category!==r||s&&"all"!==s&&e.productType!==s&&e.subcategory!==s)return!1;if(a){let t=a.toLowerCase(),r=e.name?.toLowerCase().includes(t),s=e.punjabiName?.toLowerCase().includes(t),o=e.description?.toLowerCase().includes(t),i=e.category?.toLowerCase().includes(t),n=e.productType?.toLowerCase().includes(t);if(!r&&!s&&!o&&!i&&!n)return!1}if(u&&"all"!==u){let[t,r]=u.split("-").map(e=>parseInt(e.replace("+",""))),s=parseFloat(e.price);if(r){if(s<t||s>r)return!1}else if(s<t)return!1}return!0});d.sort((e,t)=>{let r,s;switch(p){case"newest":case"createdAt":r=new Date(e.createdAt||e.updatedAt||0),s=new Date(t.createdAt||t.updatedAt||0);break;case"price-low":case"price":return r=parseFloat(e.price)||0,s=parseFloat(t.price)||0,"desc"===l?s-r:r-s;case"price-high":return r=parseFloat(e.price)||0,(s=parseFloat(t.price)||0)-r;case"rating":r=parseFloat(e.rating)||0,s=parseFloat(t.rating)||0;break;case"popular":case"reviews":r=parseInt(e.reviews)||0,s=parseInt(t.reviews)||0;break;case"name":r=e.name||"",s=t.name||"";break;default:r=e[p],s=t[p]}return"string"==typeof r&&"string"==typeof s?"desc"===l?s.localeCompare(r):r.localeCompare(s):r instanceof Date&&s instanceof Date?"desc"===l?s.getTime()-r.getTime():r.getTime()-s.getTime():"desc"===l?s-r:r-s});let g=d.length,f=(o-1)*i,m=d.slice(f,f+i).map(e=>({_id:e.id||e._id,id:e.id||e._id,...e,rating:e.rating||4.5,reviews:e.reviews||0,colors:e.colors||["Default"],sizes:e.sizes||["One Size"],images:e.images||["/placeholder.svg"]}));return n.NextResponse.json({success:!0,data:m,pagination:{page:o,limit:i,total:g,pages:Math.ceil(g/i)}})}catch(e){return console.error("Error fetching products:",e),n.NextResponse.json({success:!1,error:"Failed to fetch products"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"/Users/harsh/Downloads/punjabi-ecom-storeV4/app/api/products/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:u,workUnitAsyncStorage:d,serverHooks:g}=l;function f(){return(0,i.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:d})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},83243:(e,t,r)=>{"use strict";r.d(t,{d$:()=>i,is:()=>n});let s=new Map,a=!1;async function o(){if(!a){try{let e=r(29021),t=r(33873),a=t.resolve(process.cwd(),"data");if(e.existsSync(a)){let r=t.join(a,"products.json");if(e.existsSync(r)){let t=JSON.parse(e.readFileSync(r,"utf8"));s.set("products",t),console.log(`Loaded ${t.length} products from file into memory`)}let o=t.join(a,"orders.json");if(e.existsSync(o)){let t=JSON.parse(e.readFileSync(o,"utf8"));s.set("orders",t),console.log(`Loaded ${t.length} orders from file into memory`)}let i=t.join(a,"users.json");if(e.existsSync(i)){let t=JSON.parse(e.readFileSync(i,"utf8"));s.set("users",t),console.log(`Loaded ${t.length} users from file into memory`)}}}catch(e){console.log("Using empty memory storage (could not load from files):",e instanceof Error?e.message:"Unknown error")}a=!0}}async function i(){return await o(),s.get("products")||[]}async function n(e){await o(),s.set("products",e),console.log(`Saved ${e.length} products to memory storage`)}},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580],()=>r(58432));module.exports=s})();