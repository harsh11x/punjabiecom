(()=>{var e={};e.id=9789,e.ids=[9789],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},22289:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>N,routeModule:()=>h,serverHooks:()=>w,workAsyncStorage:()=>S,workUnitAsyncStorage:()=>j});var s={};r.r(s),r.d(s,{GET:()=>y,POST:()=>x});var n=r(96559),o=r(48088),a=r(37719),i=r(32190),u=r(29021),c=r.n(u),d=r(33873),p=r.n(d);let l=p().resolve(process.cwd(),"data"),m=p().join(l,"orders.json"),f=p().join(l,"products.json");function g(){if(!c().existsSync(m))return c().writeFileSync(m,JSON.stringify([],null,2),"utf8"),[];try{let e=c().readFileSync(m,"utf8");return JSON.parse(e)}catch(e){return console.error("Error reading orders:",e),[]}}async function y(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id"),s=t.get("orderNumber"),n=g();if(r||s){let e=n.find(e=>e._id===r||e.orderNumber===s);if(!e)return i.NextResponse.json({success:!1,error:"Order not found"},{status:404});return i.NextResponse.json({success:!0,order:e})}let o=n.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());return i.NextResponse.json({success:!0,orders:o})}catch(e){return console.error("Error fetching orders:",e),i.NextResponse.json({success:!1,error:e.message||"Failed to fetch orders"},{status:500})}}async function x(e){try{let t=await e.json();for(let e of["customerInfo","items","total","paymentMethod"])if(!t[e])return i.NextResponse.json({success:!1,error:`${e} is required`},{status:400});let{customerInfo:r}=t;if(!r.name||!r.email||!r.phone||!r.address)return i.NextResponse.json({success:!1,error:"Complete customer information is required"},{status:400});if(!Array.isArray(t.items)||0===t.items.length)return i.NextResponse.json({success:!1,error:"At least one item is required"},{status:400});let s=g(),n=function(){if(!c().existsSync(f))return[];try{let e=c().readFileSync(f,"utf8");return JSON.parse(e)}catch(e){return console.error("Error reading products:",e),[]}}();for(let e of t.items){let t=n.findIndex(t=>t.id===e.productId);if(-1===t)return i.NextResponse.json({success:!1,error:`Product ${e.name} not found`},{status:400});let r=n[t];if(r.stock<e.quantity)return i.NextResponse.json({success:!1,error:`Insufficient stock for ${e.name}. Only ${r.stock} available.`},{status:400});n[t].stock-=e.quantity,n[t].updatedAt=new Date().toISOString()}!function(e){try{c().writeFileSync(f,JSON.stringify(e,null,2),"utf8")}catch(e){throw console.error("Error saving products:",e),e}}(n);let o={_id:`order_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,orderNumber:function(){let e=new Date,t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),n=String(e.getTime()).slice(-6);return`PH-${t}${r}${s}-${n}`}(),customerInfo:{name:r.name,email:r.email,phone:r.phone,address:{street:r.address.street,city:r.address.city,state:r.address.state,pincode:r.address.pincode,country:r.address.country||"India"}},items:t.items.map(e=>({productId:e.productId,name:e.name,price:parseFloat(e.price),quantity:parseInt(e.quantity),size:e.size||"",color:e.color||"",image:e.image||""})),total:parseFloat(t.total),subtotal:parseFloat(t.subtotal||t.total),tax:parseFloat(t.tax||0),shipping:parseFloat(t.shipping||0),discount:parseFloat(t.discount||0),status:"pending",paymentMethod:t.paymentMethod,paymentStatus:"COD"===t.paymentMethod?"pending":t.paymentStatus||"pending",trackingNumber:"",notes:t.notes||"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return s.push(o),function(e){try{c().writeFileSync(m,JSON.stringify(e,null,2),"utf8")}catch(e){throw console.error("Error saving orders:",e),e}}(s),i.NextResponse.json({success:!0,message:"Order created successfully",order:o},{status:201})}catch(e){return console.error("Error creating order:",e),i.NextResponse.json({success:!1,error:e.message||"Failed to create order"},{status:500})}}c().existsSync(l)||c().mkdirSync(l,{recursive:!0});let h=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/orders/route",pathname:"/api/orders",filename:"route",bundlePath:"app/api/orders/route"},resolvedPagePath:"/Users/harsh/Downloads/punjabi-ecom-storeV4/app/api/orders/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:S,workUnitAsyncStorage:j,serverHooks:w}=h;function N(){return(0,a.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:j})}},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580],()=>r(22289));module.exports=s})();