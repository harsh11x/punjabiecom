(()=>{var e={};e.id=3805,e.ids=[3805],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77758:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>v,routeModule:()=>f,serverHooks:()=>x,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>m});var t={};s.r(t),s.d(t,{DELETE:()=>p,POST:()=>d});var o=s(96559),n=s(48088),a=s(37719),i=s(32190),u=s(43205),l=s.n(u);function c(e){let r=e.cookies.get("admin-token")?.value;if(!r)throw Error("No token provided");return l().verify(r,process.env.JWT_SECRET||"punjab-admin-secret-key")}async function d(e){try{console.log("Upload request received"),c(e),console.log("Admin token verified successfully");let r=(await e.formData()).getAll("files");if(console.log("Files received:",r.length),!r||0===r.length)return console.log("No files provided in request"),i.NextResponse.json({success:!1,error:"No files provided"},{status:400});let s=[];for(let e of r)if(e.type.startsWith("image/"))try{let r=await e.arrayBuffer(),t=Buffer.from(r),o=`data:${e.type};base64,${t.toString("base64")}`;s.push(o),console.log(`File ${e.name} converted to base64 (${Math.round(o.length/1024)}KB)`)}catch(e){console.error("Error processing file:",e)}return i.NextResponse.json({success:!0,files:s,message:`${s.length} file(s) uploaded successfully`})}catch(e){return console.error("Error uploading files:",e),console.error("Error stack:",e.stack),i.NextResponse.json({success:!1,error:e.message||"Failed to upload files"},{status:"No token provided"===e.message?401:500})}}async function p(e){try{c(e);let{searchParams:r}=new URL(e.url),s=r.get("url");if(!s)return i.NextResponse.json({success:!1,error:"Image URL is required"},{status:400});return console.log("Image deletion requested for:",s),i.NextResponse.json({success:!0,message:"File deleted successfully"})}catch(e){return console.error("Error deleting file:",e),i.NextResponse.json({success:!1,error:e.message||"Failed to delete file"},{status:"No token provided"===e.message?401:500})}}let f=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/upload/route",pathname:"/api/admin/upload",filename:"route",bundlePath:"app/api/admin/upload/route"},resolvedPagePath:"/Users/harsh/Downloads/punjabi-ecom-storeV4/app/api/admin/upload/route.ts",nextConfigOutput:"standalone",userland:t}),{workAsyncStorage:g,workUnitAsyncStorage:m,serverHooks:x}=f;function v(){return(0,a.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:m})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4447,580,3205],()=>s(77758));module.exports=t})();