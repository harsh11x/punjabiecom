(()=>{var e={};e.id=6810,e.ids=[6810],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8391:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>x,routeModule:()=>m,serverHooks:()=>g,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>y});var t={};s.r(t),s.d(t,{GET:()=>f,PUT:()=>w});var a=s(96559),n=s(48088),i=s(37719),o=s(32190),u=s(91054),c=s(43205),l=s.n(c);async function d(e){try{let r=e.cookies.get("auth-token")?.value;if(!r)return null;let s=l().verify(r,process.env.JWT_SECRET||"fallback-secret"),t=await (0,u.lC)(s.userId);if(!t)return null;return{id:t.id,email:t.email,role:t.role,name:t.name}}catch(e){return console.error("Auth verification error:",e),null}}async function p(e){let r=await d(e);if(!r)throw Error("Authentication required");return r}async function f(e){try{let r=await p(e),s=await (0,u.lC)(r.id);if(!s)return o.NextResponse.json({success:!1,error:"User not found"},{status:404});return o.NextResponse.json({success:!0,user:s})}catch(e){if(console.error("Error fetching profile:",e),"Authentication required"===e.message)return o.NextResponse.json({success:!1,error:e.message},{status:401});return o.NextResponse.json({success:!1,error:"Failed to fetch profile"},{status:500})}}async function w(e){try{let r=await p(e),{name:s,email:t,phone:a,gender:n,address:i}=await e.json(),c={};s&&(c.name=s),t&&(c.email=t),a&&(c.phone=a),n&&(c.gender=n),i&&(c.address=i);let l=await (0,u.TK)(r.id,c);if(!l)return o.NextResponse.json({success:!1,error:"User not found"},{status:404});return o.NextResponse.json({success:!0,user:{id:l.id,name:l.name,email:l.email,phone:l.phone,address:l.address,role:l.role,isVerified:!!l.isVerified},message:"Profile updated successfully"})}catch(e){if(console.error("Error updating profile:",e),"Authentication required"===e.message)return o.NextResponse.json({success:!1,error:e.message},{status:401});if("ValidationError"===e.name){let r=Object.values(e.errors).map(e=>e.message);return o.NextResponse.json({success:!1,error:r.join(", ")},{status:400})}return o.NextResponse.json({success:!1,error:"Failed to update profile"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/profile/route",pathname:"/api/auth/profile",filename:"route",bundlePath:"app/api/auth/profile/route"},resolvedPagePath:"/Users/harsh/Downloads/punjabi-ecom-storeV4/app/api/auth/profile/route.ts",nextConfigOutput:"standalone",userland:t}),{workAsyncStorage:h,workUnitAsyncStorage:y,serverHooks:g}=m;function x(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:y})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},91054:(e,r,s)=>{"use strict";s.d(r,{BE:()=>E,Gs:()=>q,OQ:()=>A,TK:()=>R,dF:()=>F,kg:()=>O,lC:()=>N,wV:()=>C});var t=s(29021),a=s.n(t),n=s(33873),i=s.n(n),o=s(28354),u=s(85665),c=s.n(u),l=s(43205),d=s.n(l);let p=(0,o.promisify)(a().mkdir),f=(0,o.promisify)(a().readFile),w=(0,o.promisify)(a().writeFile),m=(0,o.promisify)(a().access),h=i().resolve(process.cwd(),"data"),y=i().join(h,"users.json"),g=i().join(h,"sessions.json");async function x(){try{await m(h,a().constants.F_OK)}catch{await p(h,{recursive:!0})}try{await m(y,a().constants.F_OK)}catch{await w(y,JSON.stringify({version:1,users:[]},null,2),"utf8")}try{await m(g,a().constants.F_OK)}catch{await w(g,JSON.stringify({version:1,sessions:[]},null,2),"utf8")}}async function j(){return await x(),JSON.parse(await f(y,"utf8"))}async function v(e){await w(y,JSON.stringify(e,null,2),"utf8")}async function S(){return await x(),JSON.parse(await f(g,"utf8"))}async function k(e){await w(g,JSON.stringify(e,null,2),"utf8")}async function q(e){return(await j()).users.find(r=>r.email.toLowerCase()===e.toLowerCase())}async function N(e){return(await j()).users.find(r=>r.id===e)}async function O(e){if(await q(e.email))throw Error("Email already exists");let r=await c().hash(e.password,12),s=new Date().toISOString(),t={id:"u_"+Math.random().toString(36).slice(2)+Date.now().toString(36),name:e.name,email:e.email.toLowerCase(),passwordHash:r,phone:e.phone,gender:e.gender,role:e.role||"user",isVerified:!1,createdAt:s,updatedAt:s},a=await j();return a.users.push(t),await v(a),t}async function R(e,r){let s=await j(),t=s.users.findIndex(r=>r.id===e);if(-1===t)throw Error("User not found");let a=s.users[t],n=new Date().toISOString(),i=a.passwordHash;r.password&&(i=await c().hash(r.password,12));let o={...a,...function(e){let r={};return"string"==typeof e.name&&(r.name=e.name),"string"==typeof e.email&&(r.email=e.email.toLowerCase()),"string"==typeof e.phone&&(r.phone=e.phone),"string"==typeof e.gender&&(r.gender=e.gender),"object"==typeof e.address&&(r.address=e.address),"boolean"==typeof e.isVerified&&(r.isVerified=e.isVerified),r}(r),passwordHash:i,updatedAt:n};return s.users[t]=o,await v(s),o}async function E(e,r){return c().compare(r,e.passwordHash)}function A(e){return d().sign({userId:e.id,email:e.email,role:e.role},process.env.JWT_SECRET||"fallback-secret",{expiresIn:"7d"})}async function C(e,r,s){let t=await S();t.sessions.push({token:e,userId:r,issuedAt:Date.now(),expiresAt:s}),await k(t)}async function F(e){let r=await S();r.sessions=r.sessions.filter(r=>r.token!==e),await k(r)}},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4447,580,3205,5665],()=>s(8391));module.exports=t})();