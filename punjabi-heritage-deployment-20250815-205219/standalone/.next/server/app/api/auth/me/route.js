(()=>{var e={};e.id=8673,e.ids=[8673],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63700:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{GET:()=>p});var n=t(96559),a=t(48088),i=t(37719),o=t(32190),u=t(91054),d=t(43205),c=t.n(d);async function p(e){try{let r=e.cookies.get("auth-token")?.value;if(!r)return o.NextResponse.json({error:"No authentication token found"},{status:401});let t=c().verify(r,process.env.JWT_SECRET||"fallback-secret"),s=await (0,u.lC)(t.userId);if(!s)return o.NextResponse.json({error:"User not found"},{status:404});return o.NextResponse.json({user:{id:s.id,name:s.name,email:s.email,phone:s.phone,address:s.address,role:s.role,isVerified:!!s.isVerified}},{status:200})}catch(e){if(console.error("Auth verification error:",e),"JsonWebTokenError"===e.name||"TokenExpiredError"===e.name)return o.NextResponse.json({error:"Invalid or expired token"},{status:401});return o.NextResponse.json({error:"Internal server error"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/auth/me/route",pathname:"/api/auth/me",filename:"route",bundlePath:"app/api/auth/me/route"},resolvedPagePath:"/Users/harsh/Downloads/punjabi-ecom-storeV4/app/api/auth/me/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:w,serverHooks:m}=l;function h(){return(0,i.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:w})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},91054:(e,r,t)=>{"use strict";t.d(r,{BE:()=>R,Gs:()=>O,OQ:()=>C,TK:()=>N,dF:()=>A,kg:()=>q,lC:()=>E,wV:()=>b});var s=t(29021),n=t.n(s),a=t(33873),i=t.n(a),o=t(28354),u=t(85665),d=t.n(u),c=t(43205),p=t.n(c);let l=(0,o.promisify)(n().mkdir),f=(0,o.promisify)(n().readFile),w=(0,o.promisify)(n().writeFile),m=(0,o.promisify)(n().access),h=i().resolve(process.cwd(),"data"),y=i().join(h,"users.json"),x=i().join(h,"sessions.json");async function g(){try{await m(h,n().constants.F_OK)}catch{await l(h,{recursive:!0})}try{await m(y,n().constants.F_OK)}catch{await w(y,JSON.stringify({version:1,users:[]},null,2),"utf8")}try{await m(x,n().constants.F_OK)}catch{await w(x,JSON.stringify({version:1,sessions:[]},null,2),"utf8")}}async function v(){return await g(),JSON.parse(await f(y,"utf8"))}async function k(e){await w(y,JSON.stringify(e,null,2),"utf8")}async function j(){return await g(),JSON.parse(await f(x,"utf8"))}async function S(e){await w(x,JSON.stringify(e,null,2),"utf8")}async function O(e){return(await v()).users.find(r=>r.email.toLowerCase()===e.toLowerCase())}async function E(e){return(await v()).users.find(r=>r.id===e)}async function q(e){if(await O(e.email))throw Error("Email already exists");let r=await d().hash(e.password,12),t=new Date().toISOString(),s={id:"u_"+Math.random().toString(36).slice(2)+Date.now().toString(36),name:e.name,email:e.email.toLowerCase(),passwordHash:r,phone:e.phone,gender:e.gender,role:e.role||"user",isVerified:!1,createdAt:t,updatedAt:t},n=await v();return n.users.push(s),await k(n),s}async function N(e,r){let t=await v(),s=t.users.findIndex(r=>r.id===e);if(-1===s)throw Error("User not found");let n=t.users[s],a=new Date().toISOString(),i=n.passwordHash;r.password&&(i=await d().hash(r.password,12));let o={...n,...function(e){let r={};return"string"==typeof e.name&&(r.name=e.name),"string"==typeof e.email&&(r.email=e.email.toLowerCase()),"string"==typeof e.phone&&(r.phone=e.phone),"string"==typeof e.gender&&(r.gender=e.gender),"object"==typeof e.address&&(r.address=e.address),"boolean"==typeof e.isVerified&&(r.isVerified=e.isVerified),r}(r),passwordHash:i,updatedAt:a};return t.users[s]=o,await k(t),o}async function R(e,r){return d().compare(r,e.passwordHash)}function C(e){return p().sign({userId:e.id,email:e.email,role:e.role},process.env.JWT_SECRET||"fallback-secret",{expiresIn:"7d"})}async function b(e,r,t){let s=await j();s.sessions.push({token:e,userId:r,issuedAt:Date.now(),expiresAt:t}),await S(s)}async function A(e){let r=await j();r.sessions=r.sessions.filter(r=>r.token!==e),await S(r)}},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,3205,5665],()=>t(63700));module.exports=s})();