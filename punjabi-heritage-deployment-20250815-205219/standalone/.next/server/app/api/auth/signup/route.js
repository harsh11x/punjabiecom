(()=>{var e={};e.id=8887,e.ids=[8887],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},39113:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>c,serverHooks:()=>f,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{POST:()=>p});var a=r(96559),n=r(48088),i=r(37719),o=r(32190),u=r(91054);async function p(e){try{let{name:t,email:r,password:s,phone:a}=await e.json();if(!t||!r||!s)return o.NextResponse.json({error:"Name, email, and password are required"},{status:400});let n=await (0,u.kg)({name:t,email:r,password:s,phone:a}),i=(0,u.OQ)(n);await (0,u.wV)(i,n.id,Date.now()+6048e5);let p=o.NextResponse.json({message:"User created successfully",user:{id:n.id,name:n.name,email:n.email,phone:n.phone,role:n.role}},{status:201});return p.cookies.set("auth-token",i,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:6048e5}),p}catch(e){if(console.error("Signup error:",e),11e3===e.code)return o.NextResponse.json({error:"Email already exists"},{status:400});if("ValidationError"===e.name){let t=Object.values(e.errors).map(e=>e.message);return o.NextResponse.json({error:t.join(", ")},{status:400})}return o.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/signup/route",pathname:"/api/auth/signup",filename:"route",bundlePath:"app/api/auth/signup/route"},resolvedPagePath:"/Users/harsh/Downloads/punjabi-ecom-storeV4/app/api/auth/signup/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:f}=c;function w(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},91054:(e,t,r)=>{"use strict";r.d(t,{BE:()=>A,Gs:()=>k,OQ:()=>E,TK:()=>R,dF:()=>C,kg:()=>N,lC:()=>q,wV:()=>b});var s=r(29021),a=r.n(s),n=r(33873),i=r.n(n),o=r(28354),u=r(85665),p=r.n(u),c=r(43205),d=r.n(c);let l=(0,o.promisify)(a().mkdir),f=(0,o.promisify)(a().readFile),w=(0,o.promisify)(a().writeFile),m=(0,o.promisify)(a().access),y=i().resolve(process.cwd(),"data"),h=i().join(y,"users.json"),g=i().join(y,"sessions.json");async function x(){try{await m(y,a().constants.F_OK)}catch{await l(y,{recursive:!0})}try{await m(h,a().constants.F_OK)}catch{await w(h,JSON.stringify({version:1,users:[]},null,2),"utf8")}try{await m(g,a().constants.F_OK)}catch{await w(g,JSON.stringify({version:1,sessions:[]},null,2),"utf8")}}async function j(){return await x(),JSON.parse(await f(h,"utf8"))}async function v(e){await w(h,JSON.stringify(e,null,2),"utf8")}async function O(){return await x(),JSON.parse(await f(g,"utf8"))}async function S(e){await w(g,JSON.stringify(e,null,2),"utf8")}async function k(e){return(await j()).users.find(t=>t.email.toLowerCase()===e.toLowerCase())}async function q(e){return(await j()).users.find(t=>t.id===e)}async function N(e){if(await k(e.email))throw Error("Email already exists");let t=await p().hash(e.password,12),r=new Date().toISOString(),s={id:"u_"+Math.random().toString(36).slice(2)+Date.now().toString(36),name:e.name,email:e.email.toLowerCase(),passwordHash:t,phone:e.phone,gender:e.gender,role:e.role||"user",isVerified:!1,createdAt:r,updatedAt:r},a=await j();return a.users.push(s),await v(a),s}async function R(e,t){let r=await j(),s=r.users.findIndex(t=>t.id===e);if(-1===s)throw Error("User not found");let a=r.users[s],n=new Date().toISOString(),i=a.passwordHash;t.password&&(i=await p().hash(t.password,12));let o={...a,...function(e){let t={};return"string"==typeof e.name&&(t.name=e.name),"string"==typeof e.email&&(t.email=e.email.toLowerCase()),"string"==typeof e.phone&&(t.phone=e.phone),"string"==typeof e.gender&&(t.gender=e.gender),"object"==typeof e.address&&(t.address=e.address),"boolean"==typeof e.isVerified&&(t.isVerified=e.isVerified),t}(t),passwordHash:i,updatedAt:n};return r.users[s]=o,await v(r),o}async function A(e,t){return p().compare(t,e.passwordHash)}function E(e){return d().sign({userId:e.id,email:e.email,role:e.role},process.env.JWT_SECRET||"fallback-secret",{expiresIn:"7d"})}async function b(e,t,r){let s=await O();s.sessions.push({token:e,userId:t,issuedAt:Date.now(),expiresAt:r}),await S(s)}async function C(e){let t=await O();t.sessions=t.sessions.filter(t=>t.token!==e),await S(t)}},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,3205,5665],()=>r(39113));module.exports=s})();