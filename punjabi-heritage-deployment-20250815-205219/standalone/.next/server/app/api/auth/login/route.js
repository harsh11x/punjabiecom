(()=>{var e={};e.id=7758,e.ids=[7758],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},88973:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>p,serverHooks:()=>f,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{POST:()=>c});var a=r(96559),i=r(48088),n=r(37719),o=r(32190),u=r(91054);async function c(e){try{let{email:t,password:r}=await e.json();if(!t||!r)return o.NextResponse.json({error:"Email and password are required"},{status:400});let s=await (0,u.Gs)(t);if(!s||!await (0,u.BE)(s,r))return o.NextResponse.json({error:"Invalid email or password"},{status:401});let a=(0,u.OQ)(s);await (0,u.wV)(a,s.id,Date.now()+6048e5);let i=o.NextResponse.json({message:"Login successful",user:{id:s.id,name:s.name,email:s.email,phone:s.phone,role:s.role}},{status:200});return i.cookies.set("auth-token",a,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:6048e5}),i}catch(e){return console.error("Login error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Users/harsh/Downloads/punjabi-ecom-storeV4/app/api/auth/login/route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:f}=p;function w(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},91054:(e,t,r)=>{"use strict";r.d(t,{BE:()=>E,Gs:()=>k,OQ:()=>R,TK:()=>A,dF:()=>F,kg:()=>N,lC:()=>q,wV:()=>C});var s=r(29021),a=r.n(s),i=r(33873),n=r.n(i),o=r(28354),u=r(85665),c=r.n(u),p=r(43205),d=r.n(p);let l=(0,o.promisify)(a().mkdir),f=(0,o.promisify)(a().readFile),w=(0,o.promisify)(a().writeFile),m=(0,o.promisify)(a().access),y=n().resolve(process.cwd(),"data"),h=n().join(y,"users.json"),g=n().join(y,"sessions.json");async function x(){try{await m(y,a().constants.F_OK)}catch{await l(y,{recursive:!0})}try{await m(h,a().constants.F_OK)}catch{await w(h,JSON.stringify({version:1,users:[]},null,2),"utf8")}try{await m(g,a().constants.F_OK)}catch{await w(g,JSON.stringify({version:1,sessions:[]},null,2),"utf8")}}async function v(){return await x(),JSON.parse(await f(h,"utf8"))}async function j(e){await w(h,JSON.stringify(e,null,2),"utf8")}async function O(){return await x(),JSON.parse(await f(g,"utf8"))}async function S(e){await w(g,JSON.stringify(e,null,2),"utf8")}async function k(e){return(await v()).users.find(t=>t.email.toLowerCase()===e.toLowerCase())}async function q(e){return(await v()).users.find(t=>t.id===e)}async function N(e){if(await k(e.email))throw Error("Email already exists");let t=await c().hash(e.password,12),r=new Date().toISOString(),s={id:"u_"+Math.random().toString(36).slice(2)+Date.now().toString(36),name:e.name,email:e.email.toLowerCase(),passwordHash:t,phone:e.phone,gender:e.gender,role:e.role||"user",isVerified:!1,createdAt:r,updatedAt:r},a=await v();return a.users.push(s),await j(a),s}async function A(e,t){let r=await v(),s=r.users.findIndex(t=>t.id===e);if(-1===s)throw Error("User not found");let a=r.users[s],i=new Date().toISOString(),n=a.passwordHash;t.password&&(n=await c().hash(t.password,12));let o={...a,...function(e){let t={};return"string"==typeof e.name&&(t.name=e.name),"string"==typeof e.email&&(t.email=e.email.toLowerCase()),"string"==typeof e.phone&&(t.phone=e.phone),"string"==typeof e.gender&&(t.gender=e.gender),"object"==typeof e.address&&(t.address=e.address),"boolean"==typeof e.isVerified&&(t.isVerified=e.isVerified),t}(t),passwordHash:n,updatedAt:i};return r.users[s]=o,await j(r),o}async function E(e,t){return c().compare(t,e.passwordHash)}function R(e){return d().sign({userId:e.id,email:e.email,role:e.role},process.env.JWT_SECRET||"fallback-secret",{expiresIn:"7d"})}async function C(e,t,r){let s=await O();s.sessions.push({token:e,userId:t,issuedAt:Date.now(),expiresAt:r}),await S(s)}async function F(e){let t=await O();t.sessions=t.sessions.filter(t=>t.token!==e),await S(t)}},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,3205,5665],()=>r(88973));module.exports=s})();